function [fc,fi,fj,fk,idx1st,idx2nd] = harmonic_basis_gradient_original(order,flag)
% return basis for density and geometry approximation
% also index of quadrature nodes being used in two triangles
%
%
%   D ________________ C
%   |                  |
%   |                  |
%   |                  |
%   |                  |
%   |                  |
%   A ________________ B
% 
% flag = 0 are triangle ABD (A as origin, with AB and AD), and triangle BCD (C as origin, with CD and CB)
% flag = 1 are triangle ABD (B as origin, with BC and BA), and triangle BCS (B as origin, with BC and BA)... share same coordinate system after transformation
% 
%
% this is the original set of harmonic polynomial, i.e. eq(19) from "High-order close evaluation of Laplace layer potentials: A differential geometry approach" paper 
% ordered slightly different...
% However, it only goes upto degree 6 polynomial, and does not match gradient from the more generic function harmonic_basis_gradient.m 
% Hai 07/25/22
%

if nargin < 2, flag = 0; end

% gradient of 2nd order
f21x = @(x,y,z) x;                  f21y = @(x,y,z) zeros(size(x));      f21z = @(x,y,z) -z;
f22x = @(x,y,z) zeros(size(x));     f22y = @(x,y,z) y;                   f22z = @(x,y,z) -z;
% gradient of 3rd order
f31x = @(x,y,z) x.^2-z.^2;          f31y = @(x,y,z) zeros(size(x));      f31z = @(x,y,z) -2*x.*z;
f32x = @(x,y,z) y.*z;               f32y = @(x,y,z) x.*z;                f32z = @(x,y,z) x.*y;
f33x = @(x,y,z) zeros(size(x));     f33y = @(x,y,z) y.^2-z.^2;           f33z = @(x,y,z) -2*y.*z;
% gradient of 4th order
f41x = @(x,y,z) x.^3-3*x.*z.^2;     f41y = @(x,y,z) zeros(size(x));      f41z = @(x,y,z) -3*x.^2.*z+z.^3;
f42x = @(x,y,z) 6*x.*y.*z;          f42y = @(x,y,z) 3*x.^2.*z-z.^3;      f42z = @(x,y,z) 3*x.^2.*y-3*y.*z.^2;
f43x = @(x,y,z) 3*y.^2.*z-z.^3;     f43y = @(x,y,z) 6*x.*y.*z;           f43z = @(x,y,z) 3*x.*y.^2-3*x.*z.^2;
f44x = @(x,y,z) zeros(size(x));     f44y = @(x,y,z) y.^3-3*y.*z.^2;      f44z = @(x,y,z) -3*y.^2.*z+z.^3;
% gradient of 5th order
f51x = @(x,y,z) x.^4-6*x.^2.*z.^2+z.^4;      f51y = @(x,y,z) zeros(size(x));                        f51z = @(x,y,z) -4*x.^3.*z+4*x.*z.^3;
f52x = @(x,y,z) 4*x.^3.*y-12*x.*y.*z.^2;     f52y = @(x,y,z) x.^4-6*x.^2.*z.^2+z.^4;                f52z = @(x,y,z) -12*x.^2.*y.*z+4*y.*z.^3;
f53x = @(x,y,z) -6*x.*y.^2.*z+2*x.*z.^3;     f53y = @(x,y,z) -6*x.^2.*y.*z+2*y.*z.^3;               f53z = @(x,y,z) -3*x.^2.*y.^2+3*x.^2.*z.^2+3*y.^2.*z.^2-z.^4;
f54x = @(x,y,z) y.^4-6*y.^2.*z.^2+z.^4;      f54y = @(x,y,z) 4*x.*y.^3-12*x.*y.*z.^2;               f54z = @(x,y,z) -12*x.*y.^2.*z+4*x.*z.^3;
f55x = @(x,y,z) zeros(size(x));              f55y = @(x,y,z) y.^4-6*y.^2.*z.^2+z.^4;                f55z = @(x,y,z) -4*y.^3.*z+4*y.*z.^3;
% gradient of 6th order
f61x = @(x,y,z) x.^5-10*x.^3.*z.^2+5*x.*z.^4;               f61y = @(x,y,z) zeros(size(x));                             f61z = @(x,y,z) -5*x.^4.*z+10*x.^2.*z.^3-z.^5;
f62x = @(x,y,z) 5*x.^4.*y-30*x.^2.*y.*z.^2+5*y.*z.^4;       f62y = @(x,y,z) x.^5-10*x.^3.*z.^2+5*x.*z.^4;               f62z = @(x,y,z) -20*x.^3.*y.*z+20*x.*y.*z.^3;
f63x = @(x,y,z) 20*x.^3.*y.*z-20*x.*y.^3.*z;                f63y = @(x,y,z) 5*x.^4.*z-30*x.^2.*y.^2.*z+5*y.^4.*z;       f63z = @(x,y,z) 5*x.^4.*y-10*x.^2.*y.^3+y.^5;
f64x = @(x,y,z) 5*x.^4.*z-30*x.^2.*y.^2.*z+5*y.^4.*z;       f64y = @(x,y,z) -20*x.^3.*y.*z+20*x.*y.^3.*z;               f64z = @(x,y,z) x.^5-10*x.^3.*y.^2+5*x.*y.^4;
f65x = @(x,y,z) y.^5-10*y.^3.*z.^2+5*y.*z.^4;               f65y = @(x,y,z) 5*x.*y.^4-30*x.*y.^2.*z.^2+5*x.*z.^4;       f65z = @(x,y,z) -20*x.*y.^3.*z+20*x.*y.*z.^3;
f66x = @(x,y,z) zeros(size(x));                             f66y = @(x,y,z) y.^5-10*y.^3.*z.^2+5*y.*z.^4;               f66z = @(x,y,z) -5*y.^4.*z+10*y.^2.*z.^3-z.^5;
% gradient of 7th order
f71x = @(x,y,z) x.^6-15*x.^4.*z.^2+15*x.^2.*z.^4-z.^6;                                                  f71y = @(x,y,z) zeros(size(x));                                                                         f71z = @(x,y,z) -6*x.^5.*z+20*x.^3.*z.^3-6*x.*z.^5;
f72x = @(x,y,z) 6*x.^5.*y-60*x.^3.*y.*z.^2+30*x.*y.*z.^4;                                               f72y = @(x,y,z) x.^6-15*x.^4.*z.^2+15*x.^2.*z.^4-z.^6;                                                  f72z = @(x,y,z) -30*x.^4.*y.*z+60*x.^2.*y.*z.^3-6*y.*z.^5;
f73x = @(x,y,z) 15*x.^4.*y.^2-15*x.^4.*z.^2-90*x.^2.*y.^2.*z.^2+30*x.^2.*z.^4+15*y.^2.*z.^4-3*z.^6;     f73y = @(x,y,z) 6*x.^5.*y-60*x.^3.*y.*z.^2+30*x.*y.*z.^4;                                               f73z = @(x,y,z) -6*x.^5.*z-60*x.^3.*y.^2.*z+40*x.^3.*z.^3+60*x.*y.^2.*z.^3-18*x.*z.^5; 
f74x = @(x,y,z) (15*x.^4.*y-30*x.^2.*y.^3+3*y.^5).*z;                                                   f74y = @(x,y,z) (3*x.^5-30*x.^3.*y.^2+15*x.*y.^4).*z;                                                   f74z = @(x,y,z) 3*x.^5.*y-10*x.^3.*y.^3+3*x.*y.^5;
f75x = @(x,y,z) 6*x.*y.^5-60*x.*y.^3.*z.^2+30*x.*y.*z.^4;                                               f75y = @(x,y,z) 15*x.^2.*y.^4-90*x.^2.*y.^2.*z.^2-15*y.^4.*z.^2+15*x.^2.*z.^4+30*y.^2.*z.^4-3*z.^6;     f75z = @(x,y,z) -60*x.^2.*y.^3.*z-6*y.^5.*z+60*x.^2.*y.*z.^3+40*y.^3.*z.^3-18*y.*z.^5;
f76x = @(x,y,z) y.^6-15*y.^4.*z.^2+15*y.^2.*z.^4-z.^6;                                                  f76y = @(x,y,z) 6*x.*y.^5-60*x.*y.^3.*z.^2+30*x.*y.*z.^4;                                               f76z = @(x,y,z) -30*x.*y.^4.*z+60*x.*y.^2.*z.^3-6*x.*z.^5;
f77x = @(x,y,z) zeros(size(x));                                                                         f77y = @(x,y,z) y.^6-15*y.^4.*z.^2+15*y.^2.*z.^4-z.^6;                                                  f77z = @(x,y,z) -6*y.^5.*z+20*y.^3.*z.^3-6*y.*z.^5;

% 7th order
if order == 7
    fc = @(x,y,z) [  zeros(size(x)), -f71x(x,y,z), -f71y(x,y,z), -f71z(x,y,z), zeros(size(x)), -f72x(x,y,z), -f72y(x,y,z), -f72z(x,y,z), zeros(size(x)), -f73x(x,y,z), -f73y(x,y,z), -f73z(x,y,z), zeros(size(x)), -f74x(x,y,z), -f74y(x,y,z), -f74z(x,y,z), zeros(size(x)), -f75x(x,y,z), -f75y(x,y,z), -f75z(x,y,z), zeros(size(x)), -f76x(x,y,z), -f76y(x,y,z), -f76z(x,y,z), zeros(size(x)), -f77x(x,y,z), -f77y(x,y,z), -f77z(x,y,z),...
                     zeros(size(x)), -f61x(x,y,z), -f61y(x,y,z), -f61z(x,y,z), zeros(size(x)), -f62x(x,y,z), -f62y(x,y,z), -f62z(x,y,z), zeros(size(x)), -f63x(x,y,z), -f63y(x,y,z), -f63z(x,y,z), zeros(size(x)), -f64x(x,y,z), -f64y(x,y,z), -f64z(x,y,z), zeros(size(x)), -f65x(x,y,z), -f65y(x,y,z), -f65z(x,y,z), zeros(size(x)), -f66x(x,y,z), -f66y(x,y,z), -f66z(x,y,z),...
                     zeros(size(x)), -f51x(x,y,z), -f51y(x,y,z), -f51z(x,y,z), zeros(size(x)), -f52x(x,y,z), -f52y(x,y,z), -f52z(x,y,z), zeros(size(x)), -f53x(x,y,z), -f53y(x,y,z), -f53z(x,y,z), zeros(size(x)), -f54x(x,y,z), -f54y(x,y,z), -f54z(x,y,z), zeros(size(x)), -f55x(x,y,z), -f55y(x,y,z), -f55z(x,y,z),...
                     zeros(size(x)), -f41x(x,y,z), -f41y(x,y,z), -f41z(x,y,z), zeros(size(x)), -f42x(x,y,z), -f42y(x,y,z), -f42z(x,y,z), zeros(size(x)), -f43x(x,y,z), -f43y(x,y,z), -f43z(x,y,z), zeros(size(x)), -f44x(x,y,z), -f44y(x,y,z), -f44z(x,y,z),...
                     zeros(size(x)), -f31x(x,y,z), -f31y(x,y,z), -f31z(x,y,z), zeros(size(x)), -f32x(x,y,z), -f32y(x,y,z), -f32z(x,y,z), zeros(size(x)), -f33x(x,y,z), -f33y(x,y,z), -f33z(x,y,z),...
                     zeros(size(x)), -f21x(x,y,z), -f21y(x,y,z), -f21z(x,y,z), zeros(size(x)), -f22x(x,y,z), -f22y(x,y,z), -f22z(x,y,z)];

    fi = @(x,y,z) [   f71x(x,y,z), zeros(size(x)), -f71z(x,y,z),  f71y(x,y,z),  f72x(x,y,z), zeros(size(x)), -f72z(x,y,z),  f72y(x,y,z),  f73x(x,y,z), zeros(size(x)), -f73z(x,y,z),  f73y(x,y,z),  f74x(x,y,z), zeros(size(x)), -f74z(x,y,z),  f74y(x,y,z),   f75x(x,y,z), zeros(size(x)), -f75z(x,y,z),  f75y(x,y,z),   f76x(x,y,z), zeros(size(x)), -f76z(x,y,z),  f76y(x,y,z),   f77x(x,y,z), zeros(size(x)), -f77z(x,y,z),  f77y(x,y,z),...
                      f61x(x,y,z), zeros(size(x)), -f61z(x,y,z),  f61y(x,y,z),  f62x(x,y,z), zeros(size(x)), -f62z(x,y,z),  f62y(x,y,z),  f63x(x,y,z), zeros(size(x)), -f63z(x,y,z),  f63y(x,y,z),  f64x(x,y,z), zeros(size(x)), -f64z(x,y,z),  f64y(x,y,z),   f65x(x,y,z), zeros(size(x)), -f65z(x,y,z),  f65y(x,y,z),   f66x(x,y,z), zeros(size(x)), -f66z(x,y,z),  f66y(x,y,z),...
                      f51x(x,y,z), zeros(size(x)), -f51z(x,y,z),  f51y(x,y,z),  f52x(x,y,z), zeros(size(x)), -f52z(x,y,z),  f52y(x,y,z),  f53x(x,y,z), zeros(size(x)), -f53z(x,y,z),  f53y(x,y,z),  f54x(x,y,z), zeros(size(x)), -f54z(x,y,z),  f54y(x,y,z),   f55x(x,y,z), zeros(size(x)), -f55z(x,y,z),  f55y(x,y,z),...
                      f41x(x,y,z), zeros(size(x)), -f41z(x,y,z),  f41y(x,y,z),  f42x(x,y,z), zeros(size(x)), -f42z(x,y,z),  f42y(x,y,z),  f43x(x,y,z), zeros(size(x)), -f43z(x,y,z),  f43y(x,y,z),  f44x(x,y,z), zeros(size(x)), -f44z(x,y,z),  f44y(x,y,z),...
                      f31x(x,y,z), zeros(size(x)), -f31z(x,y,z),  f31y(x,y,z),  f32x(x,y,z), zeros(size(x)), -f32z(x,y,z),  f32y(x,y,z),  f33x(x,y,z), zeros(size(x)), -f33z(x,y,z),  f33y(x,y,z),...
                      f21x(x,y,z), zeros(size(x)), -f21z(x,y,z),  f21y(x,y,z),  f22x(x,y,z), zeros(size(x)), -f22z(x,y,z),  f22y(x,y,z)];

    fj = @(x,y,z) [   f71y(x,y,z),  f71z(x,y,z), zeros(size(x)), -f71x(x,y,z),  f72y(x,y,z),  f72z(x,y,z), zeros(size(x)), -f72x(x,y,z),  f73y(x,y,z),  f73z(x,y,z), zeros(size(x)), -f73x(x,y,z),  f74y(x,y,z),  f74z(x,y,z), zeros(size(x)), -f74x(x,y,z),   f75y(x,y,z),  f75z(x,y,z), zeros(size(x)), -f75x(x,y,z),   f76y(x,y,z),  f76z(x,y,z), zeros(size(x)), -f76x(x,y,z),   f77y(x,y,z),  f77z(x,y,z), zeros(size(x)), -f77x(x,y,z),...
                      f61y(x,y,z),  f61z(x,y,z), zeros(size(x)), -f61x(x,y,z),  f62y(x,y,z),  f62z(x,y,z), zeros(size(x)), -f62x(x,y,z),  f63y(x,y,z),  f63z(x,y,z), zeros(size(x)), -f63x(x,y,z),  f64y(x,y,z),  f64z(x,y,z), zeros(size(x)), -f64x(x,y,z),   f65y(x,y,z),  f65z(x,y,z), zeros(size(x)), -f65x(x,y,z),   f66y(x,y,z),  f66z(x,y,z), zeros(size(x)), -f66x(x,y,z),...
                      f51y(x,y,z),  f51z(x,y,z), zeros(size(x)), -f51x(x,y,z),  f52y(x,y,z),  f52z(x,y,z), zeros(size(x)), -f52x(x,y,z),  f53y(x,y,z),  f53z(x,y,z), zeros(size(x)), -f53x(x,y,z),  f54y(x,y,z),  f54z(x,y,z), zeros(size(x)), -f54x(x,y,z),   f55y(x,y,z),  f55z(x,y,z), zeros(size(x)), -f55x(x,y,z),...
                      f41y(x,y,z),  f41z(x,y,z), zeros(size(x)), -f41x(x,y,z),  f42y(x,y,z),  f42z(x,y,z), zeros(size(x)), -f42x(x,y,z),  f43y(x,y,z),  f43z(x,y,z), zeros(size(x)), -f43x(x,y,z),  f44y(x,y,z),  f44z(x,y,z), zeros(size(x)), -f44x(x,y,z),...
                      f31y(x,y,z),  f31z(x,y,z), zeros(size(x)), -f31x(x,y,z),  f32y(x,y,z),  f32z(x,y,z), zeros(size(x)), -f32x(x,y,z)   f33y(x,y,z),  f33z(x,y,z), zeros(size(x)), -f33x(x,y,z),...
                      f21y(x,y,z),  f21z(x,y,z), zeros(size(x)), -f21x(x,y,z),  f22y(x,y,z),  f22z(x,y,z), zeros(size(x)), -f22x(x,y,z)];

    fk = @(x,y,z) [   f71z(x,y,z), -f71y(x,y,z),  f71x(x,y,z), zeros(size(x)),  f72z(x,y,z), -f72y(x,y,z),  f72x(x,y,z), zeros(size(x)),  f73z(x,y,z), -f73y(x,y,z),  f73x(x,y,z), zeros(size(x)),  f74z(x,y,z), -f74y(x,y,z),  f74x(x,y,z), zeros(size(x)),   f75z(x,y,z), -f75y(x,y,z),  f75x(x,y,z), zeros(size(x)),   f76z(x,y,z), -f76y(x,y,z),  f76x(x,y,z), zeros(size(x)),   f77z(x,y,z), -f77y(x,y,z),  f77x(x,y,z), zeros(size(x)),...
                      f61z(x,y,z), -f61y(x,y,z),  f61x(x,y,z), zeros(size(x)),  f62z(x,y,z), -f62y(x,y,z),  f62x(x,y,z), zeros(size(x)),  f63z(x,y,z), -f63y(x,y,z),  f63x(x,y,z), zeros(size(x)),  f64z(x,y,z), -f64y(x,y,z),  f64x(x,y,z), zeros(size(x)),   f65z(x,y,z), -f65y(x,y,z),  f65x(x,y,z), zeros(size(x)),   f66z(x,y,z), -f66y(x,y,z),  f66x(x,y,z), zeros(size(x)),...
                      f51z(x,y,z), -f51y(x,y,z),  f51x(x,y,z), zeros(size(x)),  f52z(x,y,z), -f52y(x,y,z),  f52x(x,y,z), zeros(size(x)),  f53z(x,y,z), -f53y(x,y,z),  f53x(x,y,z), zeros(size(x)),  f54z(x,y,z), -f54y(x,y,z),  f54x(x,y,z), zeros(size(x)),   f55z(x,y,z), -f55y(x,y,z),  f55x(x,y,z), zeros(size(x)),...
                      f41z(x,y,z), -f41y(x,y,z),  f41x(x,y,z), zeros(size(x)),  f42z(x,y,z), -f42y(x,y,z),  f42x(x,y,z), zeros(size(x)),  f43z(x,y,z), -f43y(x,y,z),  f43x(x,y,z), zeros(size(x)),  f44z(x,y,z), -f44y(x,y,z),  f44x(x,y,z), zeros(size(x)),...
                      f31z(x,y,z), -f31y(x,y,z),  f31x(x,y,z), zeros(size(x)),  f32z(x,y,z), -f32y(x,y,z),  f32x(x,y,z), zeros(size(x)),  f33z(x,y,z), -f33y(x,y,z),  f33x(x,y,z), zeros(size(x)),...
                      f21z(x,y,z), -f21y(x,y,z),  f21x(x,y,z), zeros(size(x)),  f22z(x,y,z), -f22y(x,y,z),  f22x(x,y,z), zeros(size(x))];

    if flag
        idx1st = [ 1, 2, 3, 4, 5, 6, 7,...
                   8, 9,10,11,12,13,...
                  15,16,17,18,19,...
                  22,23,24,25,...
                  29,30,31,...
                  36,37];
        idx2nd = [49,48,47,46,45,44,...
                  42,41,40,39,38,37,...
                  35,34,33,32,31,...
                  28,27,26,25,...
                  21,20,19,...
                  14,13,...
                   7];   
    else              
        idx1st = [    2, 3, 4, 5, 6, 7,...
                   8, 9,10,11,12,13,...
                  15,16,17,18,19,...
                  22,23,24,25,...
                  29,30,31,...
                  36,37,...
                  43];
        idx2nd = [   48,47,46,45,44,43,...
                  42,41,40,39,38,37,...
                  35,34,33,32,31,...
                  28,27,26,25,...
                  21,20,19,...
                  14,13,...
                   7];    
    end
end

% 6th order
if order == 6
    fc = @(x,y,z) [  zeros(size(x)), -f61x(x,y,z), -f61y(x,y,z), -f61z(x,y,z), zeros(size(x)), -f62x(x,y,z), -f62y(x,y,z), -f62z(x,y,z), zeros(size(x)), -f63x(x,y,z), -f63y(x,y,z), -f63z(x,y,z), zeros(size(x)), -f64x(x,y,z), -f64y(x,y,z), -f64z(x,y,z), zeros(size(x)), -f65x(x,y,z), -f65y(x,y,z), -f65z(x,y,z), zeros(size(x)), -f66x(x,y,z), -f66y(x,y,z), -f66z(x,y,z),...
                     zeros(size(x)), -f51x(x,y,z), -f51y(x,y,z), -f51z(x,y,z), zeros(size(x)), -f52x(x,y,z), -f52y(x,y,z), -f52z(x,y,z), zeros(size(x)), -f53x(x,y,z), -f53y(x,y,z), -f53z(x,y,z), zeros(size(x)), -f54x(x,y,z), -f54y(x,y,z), -f54z(x,y,z), zeros(size(x)), -f55x(x,y,z), -f55y(x,y,z), -f55z(x,y,z),...
                     zeros(size(x)), -f41x(x,y,z), -f41y(x,y,z), -f41z(x,y,z), zeros(size(x)), -f42x(x,y,z), -f42y(x,y,z), -f42z(x,y,z), zeros(size(x)), -f43x(x,y,z), -f43y(x,y,z), -f43z(x,y,z), zeros(size(x)), -f44x(x,y,z), -f44y(x,y,z), -f44z(x,y,z),...
                     zeros(size(x)), -f31x(x,y,z), -f31y(x,y,z), -f31z(x,y,z), zeros(size(x)), -f32x(x,y,z), -f32y(x,y,z), -f32z(x,y,z), zeros(size(x)), -f33x(x,y,z), -f33y(x,y,z), -f33z(x,y,z),...
                     zeros(size(x)), -f21x(x,y,z), -f21y(x,y,z), -f21z(x,y,z), zeros(size(x)), -f22x(x,y,z), -f22y(x,y,z), -f22z(x,y,z)];

    fi = @(x,y,z) [   f61x(x,y,z), zeros(size(x)), -f61z(x,y,z),  f61y(x,y,z),  f62x(x,y,z), zeros(size(x)), -f62z(x,y,z),  f62y(x,y,z),  f63x(x,y,z), zeros(size(x)), -f63z(x,y,z),  f63y(x,y,z),  f64x(x,y,z), zeros(size(x)), -f64z(x,y,z),  f64y(x,y,z),   f65x(x,y,z), zeros(size(x)), -f65z(x,y,z),  f65y(x,y,z),   f66x(x,y,z), zeros(size(x)), -f66z(x,y,z),  f66y(x,y,z),...
                      f51x(x,y,z), zeros(size(x)), -f51z(x,y,z),  f51y(x,y,z),  f52x(x,y,z), zeros(size(x)), -f52z(x,y,z),  f52y(x,y,z),  f53x(x,y,z), zeros(size(x)), -f53z(x,y,z),  f53y(x,y,z),  f54x(x,y,z), zeros(size(x)), -f54z(x,y,z),  f54y(x,y,z),   f55x(x,y,z), zeros(size(x)), -f55z(x,y,z),  f55y(x,y,z),...
                      f41x(x,y,z), zeros(size(x)), -f41z(x,y,z),  f41y(x,y,z),  f42x(x,y,z), zeros(size(x)), -f42z(x,y,z),  f42y(x,y,z),  f43x(x,y,z), zeros(size(x)), -f43z(x,y,z),  f43y(x,y,z),  f44x(x,y,z), zeros(size(x)), -f44z(x,y,z),  f44y(x,y,z),...
                      f31x(x,y,z), zeros(size(x)), -f31z(x,y,z),  f31y(x,y,z),  f32x(x,y,z), zeros(size(x)), -f32z(x,y,z),  f32y(x,y,z),  f33x(x,y,z), zeros(size(x)), -f33z(x,y,z),  f33y(x,y,z),...
                      f21x(x,y,z), zeros(size(x)), -f21z(x,y,z),  f21y(x,y,z),  f22x(x,y,z), zeros(size(x)), -f22z(x,y,z),  f22y(x,y,z)];

    fj = @(x,y,z) [   f61y(x,y,z),  f61z(x,y,z), zeros(size(x)), -f61x(x,y,z),  f62y(x,y,z),  f62z(x,y,z), zeros(size(x)), -f62x(x,y,z),  f63y(x,y,z),  f63z(x,y,z), zeros(size(x)), -f63x(x,y,z),  f64y(x,y,z),  f64z(x,y,z), zeros(size(x)), -f64x(x,y,z),   f65y(x,y,z),  f65z(x,y,z), zeros(size(x)), -f65x(x,y,z),   f66y(x,y,z),  f66z(x,y,z), zeros(size(x)), -f66x(x,y,z),...
                      f51y(x,y,z),  f51z(x,y,z), zeros(size(x)), -f51x(x,y,z),  f52y(x,y,z),  f52z(x,y,z), zeros(size(x)), -f52x(x,y,z),  f53y(x,y,z),  f53z(x,y,z), zeros(size(x)), -f53x(x,y,z),  f54y(x,y,z),  f54z(x,y,z), zeros(size(x)), -f54x(x,y,z),   f55y(x,y,z),  f55z(x,y,z), zeros(size(x)), -f55x(x,y,z),...
                      f41y(x,y,z),  f41z(x,y,z), zeros(size(x)), -f41x(x,y,z),  f42y(x,y,z),  f42z(x,y,z), zeros(size(x)), -f42x(x,y,z),  f43y(x,y,z),  f43z(x,y,z), zeros(size(x)), -f43x(x,y,z),  f44y(x,y,z),  f44z(x,y,z), zeros(size(x)), -f44x(x,y,z),...
                      f31y(x,y,z),  f31z(x,y,z), zeros(size(x)), -f31x(x,y,z),  f32y(x,y,z),  f32z(x,y,z), zeros(size(x)), -f32x(x,y,z)   f33y(x,y,z),  f33z(x,y,z), zeros(size(x)), -f33x(x,y,z),...
                      f21y(x,y,z),  f21z(x,y,z), zeros(size(x)), -f21x(x,y,z),  f22y(x,y,z),  f22z(x,y,z), zeros(size(x)), -f22x(x,y,z)];

    fk = @(x,y,z) [   f61z(x,y,z), -f61y(x,y,z),  f61x(x,y,z), zeros(size(x)),  f62z(x,y,z), -f62y(x,y,z),  f62x(x,y,z), zeros(size(x)),  f63z(x,y,z), -f63y(x,y,z),  f63x(x,y,z), zeros(size(x)),  f64z(x,y,z), -f64y(x,y,z),  f64x(x,y,z), zeros(size(x)),   f65z(x,y,z), -f65y(x,y,z),  f65x(x,y,z), zeros(size(x)),   f66z(x,y,z), -f66y(x,y,z),  f66x(x,y,z), zeros(size(x)),...
                      f51z(x,y,z), -f51y(x,y,z),  f51x(x,y,z), zeros(size(x)),  f52z(x,y,z), -f52y(x,y,z),  f52x(x,y,z), zeros(size(x)),  f53z(x,y,z), -f53y(x,y,z),  f53x(x,y,z), zeros(size(x)),  f54z(x,y,z), -f54y(x,y,z),  f54x(x,y,z), zeros(size(x)),   f55z(x,y,z), -f55y(x,y,z),  f55x(x,y,z), zeros(size(x)),...
                      f41z(x,y,z), -f41y(x,y,z),  f41x(x,y,z), zeros(size(x)),  f42z(x,y,z), -f42y(x,y,z),  f42x(x,y,z), zeros(size(x)),  f43z(x,y,z), -f43y(x,y,z),  f43x(x,y,z), zeros(size(x)),  f44z(x,y,z), -f44y(x,y,z),  f44x(x,y,z), zeros(size(x)),...
                      f31z(x,y,z), -f31y(x,y,z),  f31x(x,y,z), zeros(size(x)),  f32z(x,y,z), -f32y(x,y,z),  f32x(x,y,z), zeros(size(x)),  f33z(x,y,z), -f33y(x,y,z),  f33x(x,y,z), zeros(size(x)),...
                      f21z(x,y,z), -f21y(x,y,z),  f21x(x,y,z), zeros(size(x)),  f22z(x,y,z), -f22y(x,y,z),  f22x(x,y,z), zeros(size(x))];

                  
    if flag
        idx1st = [ 1, 2, 3, 4, 5, 6,...
                   7, 8, 9,10,11,...
                  13,14,15,16,...
                  19,20,21,...
                  25,26];
        idx2nd = [36,35,34,33,32,...
                  30,29,28,27,26,...
                  24,23,22,21,...
                  18,17,16,...
                  12,11,...
                   6];   
    else    
        idx1st = [    2, 3, 4, 5, 6,...
                   7, 8, 9,10,11,...
                  13,14,15,16,...
                  19,20,21,...
                  25,26,...
                  31];
        idx2nd = [   35,34,33,32,31,...
                  30,29,28,27,26,...
                  24,23,22,21,...
                  18,17,16,...
                  12,11,...
                   6]; 
    end
end

% 5th order
if order == 5
    fc = @(x,y,z) [  zeros(size(x)), -f51x(x,y,z), -f51y(x,y,z), -f51z(x,y,z), zeros(size(x)), -f52x(x,y,z), -f52y(x,y,z), -f52z(x,y,z), zeros(size(x)), -f53x(x,y,z), -f53y(x,y,z), -f53z(x,y,z), zeros(size(x)), -f54x(x,y,z), -f54y(x,y,z), -f54z(x,y,z), zeros(size(x)), -f55x(x,y,z), -f55y(x,y,z), -f55z(x,y,z),...
                     zeros(size(x)), -f41x(x,y,z), -f41y(x,y,z), -f41z(x,y,z), zeros(size(x)), -f42x(x,y,z), -f42y(x,y,z), -f42z(x,y,z), zeros(size(x)), -f43x(x,y,z), -f43y(x,y,z), -f43z(x,y,z), zeros(size(x)), -f44x(x,y,z), -f44y(x,y,z), -f44z(x,y,z),...
                     zeros(size(x)), -f31x(x,y,z), -f31y(x,y,z), -f31z(x,y,z), zeros(size(x)), -f32x(x,y,z), -f32y(x,y,z), -f32z(x,y,z), zeros(size(x)), -f33x(x,y,z), -f33y(x,y,z), -f33z(x,y,z),...
                     zeros(size(x)), -f21x(x,y,z), -f21y(x,y,z), -f21z(x,y,z), zeros(size(x)), -f22x(x,y,z), -f22y(x,y,z), -f22z(x,y,z)];
    fi = @(x,y,z) [   f51x(x,y,z), zeros(size(x)), -f51z(x,y,z),  f51y(x,y,z),  f52x(x,y,z), zeros(size(x)), -f52z(x,y,z),  f52y(x,y,z),  f53x(x,y,z), zeros(size(x)), -f53z(x,y,z),  f53y(x,y,z),  f54x(x,y,z), zeros(size(x)), -f54z(x,y,z),  f54y(x,y,z),   f55x(x,y,z), zeros(size(x)), -f55z(x,y,z),  f55y(x,y,z),...
                      f41x(x,y,z), zeros(size(x)), -f41z(x,y,z),  f41y(x,y,z),  f42x(x,y,z), zeros(size(x)), -f42z(x,y,z),  f42y(x,y,z),  f43x(x,y,z), zeros(size(x)), -f43z(x,y,z),  f43y(x,y,z),  f44x(x,y,z), zeros(size(x)), -f44z(x,y,z),  f44y(x,y,z),...
                      f31x(x,y,z), zeros(size(x)), -f31z(x,y,z),  f31y(x,y,z),  f32x(x,y,z), zeros(size(x)), -f32z(x,y,z),  f32y(x,y,z),  f33x(x,y,z), zeros(size(x)), -f33z(x,y,z),  f33y(x,y,z),...
                      f21x(x,y,z), zeros(size(x)), -f21z(x,y,z),  f21y(x,y,z),  f22x(x,y,z), zeros(size(x)), -f22z(x,y,z),  f22y(x,y,z)];
    fj = @(x,y,z) [   f51y(x,y,z),  f51z(x,y,z), zeros(size(x)), -f51x(x,y,z),  f52y(x,y,z),  f52z(x,y,z), zeros(size(x)), -f52x(x,y,z),  f53y(x,y,z),  f53z(x,y,z), zeros(size(x)), -f53x(x,y,z),  f54y(x,y,z),  f54z(x,y,z), zeros(size(x)), -f54x(x,y,z),   f55y(x,y,z),  f55z(x,y,z), zeros(size(x)), -f55x(x,y,z),...
                      f41y(x,y,z),  f41z(x,y,z), zeros(size(x)), -f41x(x,y,z),  f42y(x,y,z),  f42z(x,y,z), zeros(size(x)), -f42x(x,y,z),  f43y(x,y,z),  f43z(x,y,z), zeros(size(x)), -f43x(x,y,z),  f44y(x,y,z),  f44z(x,y,z), zeros(size(x)), -f44x(x,y,z),...
                      f31y(x,y,z),  f31z(x,y,z), zeros(size(x)), -f31x(x,y,z),  f32y(x,y,z),  f32z(x,y,z), zeros(size(x)), -f32x(x,y,z)   f33y(x,y,z),  f33z(x,y,z), zeros(size(x)), -f33x(x,y,z),...
                      f21y(x,y,z),  f21z(x,y,z), zeros(size(x)), -f21x(x,y,z),  f22y(x,y,z),  f22z(x,y,z), zeros(size(x)), -f22x(x,y,z)];
    fk = @(x,y,z) [   f51z(x,y,z), -f51y(x,y,z),  f51x(x,y,z), zeros(size(x)),  f52z(x,y,z), -f52y(x,y,z),  f52x(x,y,z), zeros(size(x)),  f53z(x,y,z), -f53y(x,y,z),  f53x(x,y,z), zeros(size(x)),  f54z(x,y,z), -f54y(x,y,z),  f54x(x,y,z), zeros(size(x)),   f55z(x,y,z), -f55y(x,y,z),  f55x(x,y,z), zeros(size(x)),...
                      f41z(x,y,z), -f41y(x,y,z),  f41x(x,y,z), zeros(size(x)),  f42z(x,y,z), -f42y(x,y,z),  f42x(x,y,z), zeros(size(x)),  f43z(x,y,z), -f43y(x,y,z),  f43x(x,y,z), zeros(size(x)),  f44z(x,y,z), -f44y(x,y,z),  f44x(x,y,z), zeros(size(x)),...
                      f31z(x,y,z), -f31y(x,y,z),  f31x(x,y,z), zeros(size(x)),  f32z(x,y,z), -f32y(x,y,z),  f32x(x,y,z), zeros(size(x)),  f33z(x,y,z), -f33y(x,y,z),  f33x(x,y,z), zeros(size(x)),...
                      f21z(x,y,z), -f21y(x,y,z),  f21x(x,y,z), zeros(size(x)),  f22z(x,y,z), -f22y(x,y,z),  f22x(x,y,z), zeros(size(x))];
       
                  
    if flag
        idx1st = [ 1, 2, 3, 4, 5,...
                   6, 7, 8, 9,...
                  11,12,13,...
                  16,17];
        idx2nd = [25,24,23,22,...
                  20,19,18,17,...
                  15,14,13,...
                  10, 9,...
                   5]; 
    else
        idx1st = [    2, 3, 4, 5,...
                   6, 7, 8, 9,...
                  11,12,13,...
                  16,17,...
                  21];
        idx2nd = [   24,23,22,21,...
                  20,19,18,17,...
                  15,14,13,...
                  10, 9,...
                   5];  
    end
             
end


if order == 4
    fc = @(x,y,z) [  zeros(size(x)), -f41x(x,y,z), -f41y(x,y,z), -f41z(x,y,z), zeros(size(x)), -f42x(x,y,z), -f42y(x,y,z), -f42z(x,y,z), zeros(size(x)), -f43x(x,y,z), -f43y(x,y,z), -f43z(x,y,z), zeros(size(x)), -f44x(x,y,z), -f44y(x,y,z), -f44z(x,y,z),...
                     zeros(size(x)), -f31x(x,y,z), -f31y(x,y,z), -f31z(x,y,z), zeros(size(x)), -f32x(x,y,z), -f32y(x,y,z), -f32z(x,y,z), zeros(size(x)), -f33x(x,y,z), -f33y(x,y,z), -f33z(x,y,z),...
                     zeros(size(x)), -f21x(x,y,z), -f21y(x,y,z), -f21z(x,y,z), zeros(size(x)), -f22x(x,y,z), -f22y(x,y,z), -f22z(x,y,z)];
    fi = @(x,y,z) [   f41x(x,y,z), zeros(size(x)), -f41z(x,y,z),  f41y(x,y,z),  f42x(x,y,z), zeros(size(x)), -f42z(x,y,z),  f42y(x,y,z),  f43x(x,y,z), zeros(size(x)), -f43z(x,y,z),  f43y(x,y,z),  f44x(x,y,z), zeros(size(x)), -f44z(x,y,z),  f44y(x,y,z),...
                      f31x(x,y,z), zeros(size(x)), -f31z(x,y,z),  f31y(x,y,z),  f32x(x,y,z), zeros(size(x)), -f32z(x,y,z),  f32y(x,y,z),  f33x(x,y,z), zeros(size(x)), -f33z(x,y,z),  f33y(x,y,z),...
                      f21x(x,y,z), zeros(size(x)), -f21z(x,y,z),  f21y(x,y,z),  f22x(x,y,z), zeros(size(x)), -f22z(x,y,z),  f22y(x,y,z)];
    fj = @(x,y,z) [   f41y(x,y,z),  f41z(x,y,z), zeros(size(x)), -f41x(x,y,z),  f42y(x,y,z),  f42z(x,y,z), zeros(size(x)), -f42x(x,y,z),  f43y(x,y,z),  f43z(x,y,z), zeros(size(x)), -f43x(x,y,z),  f44y(x,y,z),  f44z(x,y,z), zeros(size(x)), -f44x(x,y,z),...
                      f31y(x,y,z),  f31z(x,y,z), zeros(size(x)), -f31x(x,y,z),  f32y(x,y,z),  f32z(x,y,z), zeros(size(x)), -f32x(x,y,z)   f33y(x,y,z),  f33z(x,y,z), zeros(size(x)), -f33x(x,y,z),...
                      f21y(x,y,z),  f21z(x,y,z), zeros(size(x)), -f21x(x,y,z),  f22y(x,y,z),  f22z(x,y,z), zeros(size(x)), -f22x(x,y,z)];
    fk = @(x,y,z) [   f41z(x,y,z), -f41y(x,y,z),  f41x(x,y,z), zeros(size(x)),  f42z(x,y,z), -f42y(x,y,z),  f42x(x,y,z), zeros(size(x)),  f43z(x,y,z), -f43y(x,y,z),  f43x(x,y,z), zeros(size(x)),  f44z(x,y,z), -f44y(x,y,z),  f44x(x,y,z), zeros(size(x)),...
                      f31z(x,y,z), -f31y(x,y,z),  f31x(x,y,z), zeros(size(x)),  f32z(x,y,z), -f32y(x,y,z),  f32x(x,y,z), zeros(size(x)),  f33z(x,y,z), -f33y(x,y,z),  f33x(x,y,z), zeros(size(x)),...
                      f21z(x,y,z), -f21y(x,y,z),  f21x(x,y,z), zeros(size(x)),  f22z(x,y,z), -f22y(x,y,z),  f22x(x,y,z), zeros(size(x))];
    
                  
    if flag
        idx1st = [ 1, 2, 3, 4,...
                   5, 6, 7,...
                   9,10];
        idx2nd = [16,15,14,...
                  12,11,10,...
                   8, 7,...
                   4];
    else
        idx1st = [    2, 3, 4,...
                   5, 6, 7,...
                   9,10,...
                  13];
        idx2nd = [   15,14,13,...
                  12,11,10,...
                   8, 7,...
                   4];  
    end
end

if order == 3
    fc = @(x,y,z) [  zeros(size(x)), -f31x(x,y,z), -f31y(x,y,z), -f31z(x,y,z), zeros(size(x)), -f32x(x,y,z), -f32y(x,y,z), -f32z(x,y,z), zeros(size(x)), -f33x(x,y,z), -f33y(x,y,z), -f33z(x,y,z),...
                     zeros(size(x)), -f21x(x,y,z), -f21y(x,y,z), -f21z(x,y,z), zeros(size(x)), -f22x(x,y,z), -f22y(x,y,z), -f22z(x,y,z)];
    fi = @(x,y,z) [   f31x(x,y,z), zeros(size(x)), -f31z(x,y,z),  f31y(x,y,z),  f32x(x,y,z), zeros(size(x)), -f32z(x,y,z),  f32y(x,y,z),  f33x(x,y,z), zeros(size(x)), -f33z(x,y,z),  f33y(x,y,z),...
                      f21x(x,y,z), zeros(size(x)), -f21z(x,y,z),  f21y(x,y,z),  f22x(x,y,z), zeros(size(x)), -f22z(x,y,z),  f22y(x,y,z)];
    fj = @(x,y,z) [   f31y(x,y,z),  f31z(x,y,z), zeros(size(x)), -f31x(x,y,z),  f32y(x,y,z),  f32z(x,y,z), zeros(size(x)), -f32x(x,y,z)   f33y(x,y,z),  f33z(x,y,z), zeros(size(x)), -f33x(x,y,z),...
                      f21y(x,y,z),  f21z(x,y,z), zeros(size(x)), -f21x(x,y,z),  f22y(x,y,z),  f22z(x,y,z), zeros(size(x)), -f22x(x,y,z)];
    fk = @(x,y,z) [   f31z(x,y,z), -f31y(x,y,z),  f31x(x,y,z), zeros(size(x)),  f32z(x,y,z), -f32y(x,y,z),  f32x(x,y,z), zeros(size(x)),  f33z(x,y,z), -f33y(x,y,z),  f33x(x,y,z), zeros(size(x)),...
                      f21z(x,y,z), -f21y(x,y,z),  f21x(x,y,z), zeros(size(x)),  f22z(x,y,z), -f22y(x,y,z),  f22x(x,y,z), zeros(size(x))]; 
                  
    idx1st = [    2, 3,...
               4, 5,...
               7];
    idx2nd = [    8, 7,...
               6, 5,...
               3];  
end

if order == 2
    fc = @(x,y,z) [  zeros(size(x)), -f21x(x,y,z), -f21y(x,y,z), -f21z(x,y,z), zeros(size(x)), -f22x(x,y,z), -f22y(x,y,z), -f22z(x,y,z)];
    fi = @(x,y,z) [   f21x(x,y,z), zeros(size(x)), -f21z(x,y,z),  f21y(x,y,z),  f22x(x,y,z), zeros(size(x)), -f22z(x,y,z),  f22y(x,y,z)];
    fj = @(x,y,z) [   f21y(x,y,z),  f21z(x,y,z), zeros(size(x)), -f21x(x,y,z),  f22y(x,y,z),  f22z(x,y,z), zeros(size(x)), -f22x(x,y,z)];
    fk = @(x,y,z) [   f21z(x,y,z), -f21y(x,y,z),  f21x(x,y,z), zeros(size(x)),  f22z(x,y,z), -f22y(x,y,z),  f22x(x,y,z), zeros(size(x))];
    
    
    if flag
        idx1st = [ 1, 2, 3,...
                   4, 5];
        idx2nd = [ 9, 8,...
                   6, 5,...
                   3]; 
    else
        idx1st = [    2,...
                   3];
        idx2nd = [    3,...
                   2]; 
    end
    
end  


end
